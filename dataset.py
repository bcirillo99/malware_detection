import os
import tarfile

def get_file_list(path_tar):
    file_list_benign=[]
    file_list_malign=[]
    tar = tarfile.open(path_tar,"r")
    for member in tar.getmembers():
        info_member=member.get_info()
        if info_member['size']>0:   #Ã¨ un file e non una dir
            name_splitted=info_member['name'].split('/')
            train_or_val=name_splitted[-3]
            malware_type=name_splitted[-2]
            if(train_or_val=='validation' or train_or_val=='train'):
                if(malware_type=='benign'):
                    file_list_benign.append(info_member['name'])
                else:
                    file_list_malign.append(info_member['name'])
           
    tar.close()
    return file_list_benign,file_list_malign

path_tar="C:\\Users\\dario\\Downloads\\dataset.tar"

file_list_benign, file_list_malign=get_file_list(path_tar)
print(len(file_list_benign), len(file_list_malign))


path_new="C:\\Users\\dario\\Downloads\\dataset_new.tar"
tar_new=tarfile.open(path_new, 'w')

count_train=len(file_list_benign)-2*len(file_list_benign)/5
count_val=len(file_list_benign)/5
count_test=len(file_list_benign)/5
#####CREATE TRAIN
for i in range(0, len(file_list_benign)):
    if(count_train>0):
        count_train=count_train-1

        tar_new.add()
        
        tar_new.add()
    elif (count_val>0):
        count_val=count_val-1
    elif (count_test):
        count_test=count_test-1